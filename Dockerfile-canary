FROM ansibleplaybookbundle/apb-base:canary
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.spec"=\
"IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBTaGFyZWQgUGFyYW1ldGVycwojIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIwpfcDogJl9wCiAgLSBuYW1lOiBwb3N0Z3Jlc3FsX2RhdGFiYXNlCiAgICBkZWZh\
dWx0OiBhZG1pbgogICAgdHlwZTogc3RyaW5nCiAgICB0aXRsZTogUG9zdGdyZVNRTCBEYXRhYmFz\
ZSBOYW1lCiAgICByZXF1aXJlZDogdHJ1ZQogIC0gbmFtZTogcG9zdGdyZXNxbF91c2VyCiAgICBk\
ZWZhdWx0OiBhZG1pbgogICAgdGl0bGU6IFBvc3RncmVTUUwgVXNlcgogICAgdHlwZTogc3RyaW5n\
CiAgICBtYXhsZW5ndGg6IDYzCiAgICByZXF1aXJlZDogdHJ1ZQogIC0gbmFtZTogcG9zdGdyZXNx\
bF9wYXNzd29yZAogICAgdHlwZTogc3RyaW5nCiAgICBkZXNjcmlwdGlvbjogQSByYW5kb20gYWxw\
aGFudW1lcmljIHN0cmluZyBpZiBsZWZ0IGJsYW5rCiAgICB0aXRsZTogUG9zdGdyZVNRTCBQYXNz\
d29yZAogICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgcmVxdWlyZWQ6IHRydWUKICAtIG5h\
bWU6IHBvc3RncmVzcWxfdmVyc2lvbgogICAgZGVmYXVsdDogJzkuNicKICAgIGVudW06IFsnOS42\
JywgJzkuNScsICc5LjQnXQogICAgdHlwZTogZW51bQogICAgdGl0bGU6IFBvc3RncmVTUUwgVmVy\
c2lvbgogICAgcmVxdWlyZWQ6IHRydWUKICAgIHVwZGF0YWJsZTogdHJ1ZQojIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIwp2ZXJzaW9uOiAxLjAKbmFtZTogcG9zdGdyZXNxbC1hcGIKZGVzY3JpcHRpb246\
IFNDTCBQb3N0Z3JlU1FMIGFwYiBpbXBsZW1lbnRhdGlvbgpiaW5kYWJsZTogdHJ1ZQphc3luYzog\
b3B0aW9uYWwKdGFnczoKICAtIGRhdGFiYXNlCiAgLSBwb3N0Z3Jlc3FsCm1ldGFkYXRhOgogIGRv\
Y3VtZW50YXRpb25Vcmw6IGh0dHBzOi8vd3d3LnBvc3RncmVzcWwub3JnL2RvY3MvCiAgbG9uZ0Rl\
c2NyaXB0aW9uOiBBbiBhcGIgdGhhdCBkZXBsb3lzIHBvc3RncmVzcWwgOS40LCA5LjUsIG9yIDku\
Ni4KICBkZXBlbmRlbmNpZXM6CiAgICAtICdyZWdpc3RyeS5hY2Nlc3MucmVkaGF0LmNvbS9yaHNj\
bC9wb3N0Z3Jlc3FsLTk0LXJoZWw3JwogICAgLSAncmVnaXN0cnkuYWNjZXNzLnJlZGhhdC5jb20v\
cmhzY2wvcG9zdGdyZXNxbC05NS1yaGVsNycKICAgIC0gJ3JlZ2lzdHJ5LmFjY2Vzcy5yZWRoYXQu\
Y29tL3Joc2NsL3Bvc3RncmVzcWwtOTYtcmhlbDcnCiAgZGlzcGxheU5hbWU6IFBvc3RncmVTUUwg\
KEFQQikKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6IGljb24tcG9zdGdyZXNxbAog\
IHByb3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRl\
dgogICAgZGVzY3JpcHRpb246IEEgc2luZ2xlIERCIHNlcnZlciB3aXRoIG5vIHN0b3JhZ2UKICAg\
IGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGV2ZWxvcG1lbnQK\
ICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMgYSBzaW5nbGUgbm9uLUhB\
IFBvc3RncmVTUUwgc2VydmVyIHdpdGhvdXQgcGVyc2lzdGVudCBzdG9yYWdlCiAgICAgIGNvc3Q6\
ICQwLjAwCiAgICBwYXJhbWV0ZXJzOiAqX3AKICAgIHVwZGF0ZXNfdG86CiAgICAgIC0gcHJvZAog\
IC0gbmFtZTogcHJvZAogICAgZGVzY3JpcHRpb246IEEgc2luZ2xlIERCIHNlcnZlciB3aXRoIHBl\
cnNpc3RlbnQgc3RvcmFnZQogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3Bs\
YXlOYW1lOiBQcm9kdWN0aW9uCiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3Zp\
ZGVzIGEgc2luZ2xlIG5vbi1IQSBQb3N0Z3JlU1FMIHNlcnZlciB3aXRoIHBlcnNpc3RlbnQgc3Rv\
cmFnZQogICAgICBjb3N0OiAkMC4wMAogICAgcGFyYW1ldGVyczogKl9wCiAgICB1cGRhdGVzX3Rv\
OgogICAgICAtIGRldgo="


# install the client for use during bind
RUN yum -y install postgresql && yum clean all


COPY roles /opt/ansible/roles
COPY playbooks/* /opt/apb/actions/
RUN chmod -R g=u /opt/{ansible,apb}

USER apb
